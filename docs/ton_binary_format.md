# TON バイナリフォーマットの構造

TON の各型は、1つの連続したバイト列としてエンコードされ、以下の4つのフィールドで構成されます。
- *識別子*
- *長さサイズ*
- *データ長*
- *データ本体*

また *識別子*, *長さサイズ*, *データ長* は **head**  
*データ本体* を **body** と言っています

全体のエンコード形式は次のように表現されます:


| *識別子* (6ビット) | *長さサイズ* (2ビット) | *データ長* (8～64ビット)   | *データ本体* (可変長)  |
|------------------|--------------------|-------------------------|----------------------|
| 固有の型ID       | データ長の長さを指定       | 実際のデータ長を示す      | 格納する実データ       |


## 詳細

| フィールド名 | ビット数         | 説明                                   | 詳細/備考                                                                                                                                          |
|--------------|------------------|----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| *識別子*       | 6ビット          | 型を識別する固有のID                     | 各型に固有の値が割り当てられています。                                                                                                               |
| *長さサイズ*   | 2ビット          | 「データ長」フィールドのサイズを示す     | `00`: 1バイト (最大 255バイト)<br>`01`: 2バイト (最大 65,535バイト)<br>`10`: 4バイト (最大 4,294,967,295バイト)<br>`11`: 8バイト (最大 18,446,744,073,709,551,615バイト) |
| *データ長*     | 可変 (8～64ビット) | 実際のデータのバイト数を表す              | 「長さサイズ」で指定されたバイト数を用いてエンコードされます。                                                                                         |
| *データ本体*   | 可変             | 実際の値や文字列、バイナリなどのデータ      | 実際のデータが格納されるフィールドです。                                                                                                              |

## 考え
- *head* を先頭に持ってくることにより、どこまでが *body* で、どのような情報を持っているのかを即座に知れ、パース処理を大幅に簡略化できます
- *データ長* の表現を可変長にすることでサイズを最小化します

